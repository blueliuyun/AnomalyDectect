# -*- coding: utf-8 -*-
"""
Created on Sun Nov 25 23:28:34 2018

@author: tianye
 1. SVD 奇异值原理。
"""

import pandas as pd
import numpy as np
import banpei
import pylab


raw_data = pd.read_csv('./banpei-master_20181125/tests/test_data/example_wp_log_peyton_manningIndex577.csv')
#data = raw_data['y']
data = np.array([0, 0, 0, 1, 0, 1, 0, 0, 1, 0, 0, 0, 0, 1, 0, 0, 0, 1, 0, 0, 0, 0, 0, 0, 0, 1, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 1, 0, 0, 0, 0, 0, 1, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 1, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 1, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 1, 0, 0, 0, 0, 0, 0, 1, 0, 0, 0, 0, 0, 0, 0, 1, 0, 0, 1, 0, 0, 0, 0, 1, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 1, 0, 1, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 1, 0, 0, 1, 0, 0, 1, 0, 0, 0, 0, 0, 0, 0, 0, 1, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 1, 0, 0, 0, 0, 0, 0, 1, 1, 0, 0, 0, 0, 0, 1, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 1, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 1, 0, 0, 1, 1, 0, 0, 1, 0, 0, 0, 0, 0, 1, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 1, 1, 1, 1, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 1, 0, 0, 0, 0, 1, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 1, 0, 0, 0, 1, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 1, 0, 1, 0, 0, 0, 0, 0, 1, 0, 1, 0, 0, 0, 0, 0, 0, 1, 0, 0, 0, 0, 0, 1, 1, 0, 1, 0, 0, 0, 0, 0, 1, 0, 0, 0, 0, 0, 1, 0, 0, 0, 0, 0, 1, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 1, 0, 0, 0, 0, 0, 0, 0, 0, 1, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 1, 1, 0, 0, 0, 0, 0, 0, 0, 0, 0, 1, 0, 0, 0, 0, 1, 1, 0, 0, 1, 0, 0, 0, 1, 0, 0, 0, 0, 0, 1, 0, 0, 0, 0, 0, 0, 0, 0, 1, 0, 0, 0, 0, 0, 1, 0, 0, 0, 0, 0, 1, 0, 0, 0, 0, 1, 1, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 1, 0, 0, 0, 1, 1, 0, 0, 0, 0, 0, 0, 0, 1, 0, 0, 1, -211, -111, -70, -105, -81, -87, -89, -76, -81, -81, -74, -76, -75, -69, -69, -68, -63, -61, -59, -54, -50, -48, -44, -40, -36, -32, -28, -24, -20, -15, -12, -7, -2, 0, 5, 9, 14, 18, 22, 26, 30, 35, 38, 42, 46, 50, 53, 57, 60, 63, 66, 69, 72, 74, 76, 79, 81, 83, 84, 85, 87, 88, 88, 89, 90, 90, 89, 89, 88, 88, 87, 85, 85, 83, 81, 79, 77, 75, 72, 70, 67, 63, 61, 57, 55, 51, 46, 43, 39, 36, 31, 27, 22, 19, 15, 10, 6, 1, -1, -7, -11, -15, -19, -23, -28, -31, -36, -39, -43, -47, -51, -54, -57, -60, -63, -66, -69, -71, -74, -76, -78, -80, -81, -83, -84, -85, -85, -85, -87, -87, -87, -86, -85, -84, -84, -83, -82, -80, -78, -76, -74, -72, -69, -67, -64, -61, -58, -54, -51, -48, -44, -41, -36, -33, -29, -24, -20, -16, -12, -7, -3, 0, 5, 9, 14, 17, 22, 26, 30, 34, 38, 42, 46, 50, 53, 56, 60, 63, 66, 69, 72, 74, 76, 79, 81, 83, 84, 86, 87, 88, 88, 89, 89, 89, 89, 89, 88, 88, 87, 85, 84, 83, 81, 79, 77, 75, 72, 69, 67, 64, 60, 57, 54, 51, 47, 43, 38, 35, 31, 28, 23, 18, 14, 9, 6, 1, -2, -6, -11, -15, -19, -24, -28, -32, -36, -39, -43, -47, -50, -54, -58, -60, -63, -66, -69, -71, -74, -76, -78, -80, -81, -83, -84, -85, -86, -86, -87, -87, -87, -86, -86, -85, -84, -83, -82, -80, -78, -76, -75, -72, -69, -67, -64, -61, -58, -55, -52, -48, -44, -40, -37, -33, -29, -24, -20, -16, -11, -8, -3, 0, 5, 9, 14, 17, 22, 26, 30, 34, 38, 42, 45, 50, 53, 57, 60, 64, 67, 68, 72, 74, 76, 78, 81, 82, 84, 85, 86, 87, 88, 88, 90, 89, 89, 89, 88, 87, 86, 85, 84, 82, 81, 78, 77, 74, 71, 69, 67, 64, 60, 58, 54, 50, 46, 43, 39, 35, 30, 26, 23, 18, 14, 9, 6, 1, -2, -6, -12, -15, -19, -24, -28, -31, -36, -40, -43, -47, -51, -55, -57, -61, -64, -66, -69, -71, -74, -77, -78, -80, -82, -83, -84, -85, -86, -86, -87, -87, -86, -86, -86, -85, -84, -83, -82, -80, -78, -77, -74, -72, -69, -67, -64, -61, -58, -55, -51, -48, -45, -40, -37, -33, -29, -24, -20, -16, -12, -7, -3, 0, 4, 9, 13, 17, 22, 26, 30, 34, 38, 42, 45, 49, 53, 57, 60, 63, 66, 68, 71, 74, 76, 78, 81, 83, 84, 85, 87, 87, 88, 88, 89, 89, 89, 88, 89, 87, 86, 85, 84, 82, 80, 79, 76, 74, 72, 68, 66, 63, 60, 57, 53, 51, 46, 43, 39, 35, 31, 27, 22, 19, 14, 10, 6, 1, -2, -7, -11, -15, -20, -24, -27, -32, -36, -40, -43, -47, -51, -54, -58, -61, -64, -66, -69, -72, -74, -76, -78, -80, -81, -83, -84, -85, -86, -86, -87, -87, -87, -86, -87, -85, -84, -84, -82, -80, -79, -76, -74, -72, -69, -67, -65, -62, -58, -55, -52, -48, -44, -41, -38, -32, -30, -24, -21, -16, -12, -7, -3, 0, 5, 8, 13, 17, 22, 26, 30, 34, 38, 42, 45, 49, 53, 56, 59, 63, 66, 68, 72, 74, 76, 79, 80, 82, 84, 86, 87, 87, 88, 89, 89, 88, 89, 89, 88, 87, 86, 85, 84, 83, 81, 78, 76, 74, 71, 69, 67, 63, 60, 57, 54, 51, 46, 42, 38, 35, 30, 27, 22, 18, 14, 9, 5, 0, -2, -7, -11, -15, -19, -23, -28, -32, -36, -39, -44, -47, -51, -54, -57, -61, -64, -67, -69, -72, -74, -76, -78, -80, -82, -83, -84, -85, -85, -86, -87, -86, -87, -86, -86, -86, -84, -84, -82, -81, -79, -76, -75, -72, -70, -68, -64, -61, -58, -55, -52, -48, -44, -41, -37, -33, -29, -24, -21, -16, -12, -8, -3, 0, 5, 8, 13, 18, 21, 26, 30, 34, 38, 42, 45, 49, 52, 56, 59, 62, 66, 68, 71, 74, 76, 78, 79, 83, 84, 84, 85, 87, 87, 88, 89, 89, 89, 88, 87, 87, 87, 84, 84, 82, 80, 79, 77, 74, 71, 69, 67, 63, 61, 57, 54, 50, 47, 43, 39, 35, 30, 26, 22, 18, 14, 9, 5, 1, -2, -6, -11, -15, -19, -24, -28, -32, -36, -40, -44, -47, -51, -55, -58, -61, -63, -67, -69, -72, -75, -76, -79, -80, -82, -84, -84, -85, -86, -86, -87, -87, -87, -87, -86, -85, -85, -83, -82, -81, -78, -77, -75, -73, -70, -68, -65, -61, -59, -55, -52, -48, -45, -41, -37, -33, -29, -25, -21, -16, -12, -8, -3, 0, 4, 8, 13, 17, 21, 25, 30, 33, 38, 41, 45, 50, 53, 56, 60, 63, 66, 69, 71, 74, 76, 78, 80, 81, 84, 85, 86, 87, 87, 89, 89, 88, 89, 89, 88, 87, 86, 85, 84, 82, 81, 78, 76, 74, 71, 69, 66, 63, 60, 57, 53, 51, 46, 43, 39, 35, 30, 26, 23, 18, 14, 10, 6, 0, -2, -6, -11, -15, -19, -24, -28, -32, -36, -40, -43, -47, -51, -54, -58, -61, -64, -67, -69, -72, -74, -76, -79, -81, -82, -83, -84, -86, -86, -87, -87, -87, -87, -87, -86, -85, -84, -84, -82, -81, -79, -76, -75, -72, -70, -67, -64, -61, -59, -55, -52, -48, -45, -41, -37, -33, -29, -24, -21, -16, -12, -7, -3, 0, 4, 8, 12, 17, 22, 26, 30, 33, 38, 42, 45, 49, 53, 56, 59, 62, 65, 68, 71, 73, 76, 79, 80, 81, 84, 84, 86, 87, 88, 88, 89, 89, 89, 89, 88, 87, 86, 85, 84, 82, 80, 78, 76, 74, 71, 69, 67, 63, 60, 58, 53, 50, 46, 43, 38, 35, 30, 26, 22, 18, 14, 10, 5, 1, -2, -6, -11, -15, -19, -24, -28, -32, -36, -40, -44, -47, -51, -54, -58, -61, -64, -67, -69, -72, -75, -77, -78, -80, -82, -84, -84, -85, -86, -86, -87, -87, -87, -86, -86, -85, -84, -84, -82, -80, -79, -77, -75, -73, -70, -67, -65, -61, -59, -55, -52, -48, -45, -41, -38, -33, -29, -25, -21, -17, -12, -8, -4, 0, 4, 8, 13, 18, 22, 25, 30, 34, 38, 42, 45, 49, 53, 55, 60, 62, 66, 68, 71, 74, 76, 78, 81, 82])

pylab.subplot(211)
fig = pylab.plot(data, color="green", lw=2)

model   = banpei.SST(w=128)
results = model.detect(data)
print('Find the Change Point Index is %d' % (results.tolist().index(max(results))))

pylab.subplot(212)
fig = pylab.plot(results, color="red", lw=2)